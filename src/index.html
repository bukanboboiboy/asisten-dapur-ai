<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recipe Generator</title>
    <!-- Font Styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Link to your external CSS file (kept as requested) -->
    <link href="/asisten-dapur-ai/src/assets/css/output.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/script.js" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <ul>
        <img src="" alt="Logo Asisten Dapur" />
        <a href="">SmartChef </a>
      </ul>
      <ul>
        <li><a href="">Home</a></li>
        <li><a href="">Tutorial</a></li>
        <li><a href="">About</a></li>
      </ul>
    </nav>
    <!-- Hero Section -->
    <section class="hero">
      <div class="promptplace">
        <h1>Mau Masak Apa Hari Ini?</h1>
        <p>
          Stop bengong bingung makan apa! <br />
          Ketik saja bahan yang kamu punya, biar AI kasih resep spesial anti
          ribet
        </p>
        <!-- Input area for user query -->
        <div class="inputarea">
          <textarea
            class="overflow-hidden box-border resize-none"
            id="recipeQuery"
            placeholder="Contoh: ayam, bawang bombay, paprika, tomat..."
          ></textarea>
        </div>
        <!-- Generate button -->
        <button class="generateBtn" id="generateBtn">Buat Resep</button>
        <div class="loader" id="loadingIndicator"></div>
      </div>
      <div class="card-container">
        <img src="assets/img/5.png" alt="" class="background-shape" />

        <img
          src="assets/img/sepiringnasgor.png"
          alt="Makanan dengan Telur Mata Sapi"
          class="food-image"
        />
      </div>
    </section>
    <section>
      <div class="result-area" id="resultArea">
        <!-- Hasil resep dari AI akan muncul di sini -->
        <img
          id="recipeImage"
          src=""
          alt="Gambar Resep AI"
          style="
            display: none;
            max-width: 100%;
            border-radius: 12px;
            margin-bottom: 25px;
          "
        />
      </div>
    </section>

    <!-- footer -->
    <footer></footer>

    <script>
      const textarea = document.getElementById("recipeQuery");
      const generateBtn = document.getElementById("generateBtn");

      // auto resize pas ngetik
      textarea.addEventListener("input", () => {
        textarea.style.height = "auto";
        textarea.style.height = textarea.scrollHeight + "px";
      });

      // enter handler
      textarea.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault(); // cegah newline
          generateBtn.click(); // trigger tombol
        }
      });
      // Pastikan ID ini cocok dengan yang ada di HTML Anda
      // Pada contoh sebelumnya, kita menggunakan id="loader", bukan "loadingIndicator"
      const recipeQuery = document.getElementById("recipeQuery");
      const loader = document.getElementById("loadingIndicator"); // Ubah: Sesuaikan nama variabel jika perlu
      const resultArea = document.getElementById("resultArea");

      generateBtn.addEventListener("click", async () => {
        const query = recipeQuery.value;
        if (!query.trim()) {
          alert("Tolong tulis dulu bahan-bahan atau keinginanmu!");
          return;
        }

        // Tampilkan loading, sembunyikan hasil lama, nonaktifkan tombol
        loader.style.display = "block";
        resultArea.style.display = "none";
        generateBtn.disabled = true;

        try {
          // **PENTING: Ganti URL ini dengan URL API Gateway-mu yang baru**
          const apiUrl =
            "https://0fzrd2ww9b.execute-api.us-east-1.amazonaws.com/default/AI-Kitchen-Assistant";

          const payload = {
            query: query,
          };

          const response = await fetch(apiUrl, {
            method: "POST",
            body: JSON.stringify(payload),
            headers: { "Content-Type": "application/json" },
          });

          const result = await response.json();

          if (response.ok) {
            // Tampilkan hasil teks resep
            recipeText.textContent = result.recipe;

            // Tampilkan hasil gambar dari data Base64
            if (result.image) {
              // Ini adalah baris kuncinya
              recipeImage.src = "data:image/png;base64," + result.image;
              recipeImage.style.display = "block";
            }

            resultArea.style.display = "block";
          } else {
            throw new Error(result.message || "Gagal menghasilkan resep.");
          }
        } catch (error) {
          console.error("Error:", error);
          resultArea.textContent = `Terjadi kesalahan: ${error.message}`;
          resultArea.style.display = "block";
        } finally {
          // Sembunyikan loading, aktifkan kembali tombol
          loader.style.display = "none";
          generateBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
